<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <!-- Importing the modern Roboto font -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SNAP Map Texas!</title>
    <style>
        /* Vibrant color palette that grabs attention */
        body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(to bottom right, #FF4500, #FFD700);
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }
        header {
            text-align: center;
            margin-bottom: 20px;
        }
        header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 700;
        }
        header p {
            margin: 10px 0 0;
            font-size: 1.2em;
            font-weight: 400;
        }
        .chart-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            flex: 1;
        }
        svg {
            width: 90%;
            height: 90%;
        }
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 10px;
            border-radius: 6px;
            pointer-events: none;
            font-size: 13px;
            line-height: 1.4;
            opacity: 0;
            transition: opacity 0.3s;
        }
        /* Style for the Zoom Out button */
        #zoomOut {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
        }
    </style>
</head>
<body>
    <header>
        <h1>SNAP Map Texas!</h1>
        <p>
            Below are retailers in Texas that accept SNAP.
            Hover over a point for detailed store information, and click on a point to zoom in for a closer look.
            Use the Zoom Out button to return to the full view.
        </p>
    </header>
    <button id="zoomOut" style="display:none;">Zoom Out</button>
    <div class="chart-container">
        <!-- Fixed viewBox dimensions ensure consistent scaling and centering -->
        <svg viewBox="0 0 800 600" preserveAspectRatio="xMidYMid meet"></svg>
    </div>
    <div class="tooltip" id="tooltip"></div>
    
    <!-- Load D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        const viewBoxWidth = 800;
        const viewBoxHeight = 600;
        const margin = { top: 40, right: 40, bottom: 60, left: 40 };
        const innerWidth = viewBoxWidth - margin.left - margin.right;
        const innerHeight = viewBoxHeight - margin.top - margin.bottom;
        
        const svg = d3.select("svg");
        // Create an outer group that applies the margins
        const outerG = svg.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        // Create a group for the zoomable plot
        const plotGroup = outerG.append("g");
        
        const tooltip = d3.select("#tooltip");
        
        d3.csv("data.csv").then(data => {
            data.forEach(d => {
                d.X = parseFloat(d.X);
                d.Y = parseFloat(d.Y);
            });
            
            const xExtent = d3.extent(data, d => d.X);
            const yExtent = d3.extent(data, d => d.Y);
            
            const xRange = xExtent[1] - xExtent[0];
            const yRange = yExtent[1] - yExtent[0];
            
            // Calculate a common scale to preserve the aspect ratio of the Texas shape
            const scale = Math.min(innerWidth / xRange, innerHeight / yRange);
            // Calculate offsets to center the shape within the inner drawing area
            const offsetX = (innerWidth - xRange * scale) / 2;
            const offsetY = (innerHeight - yRange * scale) / 2;
            
            // Define scales as functions using the common scale factor
            const xScale = d => (d - xExtent[0]) * scale + offsetX;
            // Invert Y so that smaller values appear at the bottom
            const yScale = d => innerHeight - ((d - yExtent[0]) * scale + offsetY);
            
            // Draw circles for each store location
            plotGroup.selectAll("circle")
            .data(data)
            .enter()
            .append("circle")
            .attr("cx", d => xScale(d.X))
            .attr("cy", d => yScale(d.Y))
            .attr("r", 6)
            .attr("fill", "#D32F2F")
            .attr("stroke", "#fff")
            .attr("stroke-width", 1.5)
            .on("mouseover", function(event, d) {
                d3.select(this).attr("fill", "#fff");
                tooltip.transition().duration(200).style("opacity", 1);
                tooltip.html(
                "<strong>" + d.Store_Name + "</strong><br>" +
                (d.Store_Street_Address ? d.Store_Street_Address + "<br>" : "") +
                (d.Additonal_Address ? d.Additonal_Address + "<br>" : "") +
                d.City + ", " + d.State + " " + d.Zip_Code + "<br>" +
                "County: " + d.County + "<br>" +
                "Type: " + d.Store_Type
                )
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function(event, d) {
                d3.select(this).attr("fill", "#D32F2F");
                tooltip.transition().duration(200).style("opacity", 0);
            })
            .on("click", function(event, d) {
                // Get the clicked circle's coordinates
                const cx = xScale(d.X);
                const cy = yScale(d.Y);
                const zoomScale = 2; // Define a zoom-in scale factor
                // Calculate translation values to center the clicked point in the inner drawing area
                const tx = innerWidth / 2 - zoomScale * cx;
                const ty = innerHeight / 2 - zoomScale * cy;
                // Apply the zoom transformation to the plotGroup
                plotGroup.transition().duration(750)
                .attr("transform", "translate(" + tx + "," + ty + ") scale(" + zoomScale + ")");
                // Display the Zoom Out button
                d3.select("#zoomOut").style("display", "block");
            });
            
            // Zoom Out button: Reset the transformation on the plotGroup
            d3.select("#zoomOut").on("click", function() {
                plotGroup.transition().duration(750)
                .attr("transform", "translate(0,0) scale(1)");
                d3.select(this).style("display", "none");
            });
        })
        .catch(error => {
            console.error("Error loading the CSV file:", error);
        });
    </script>
</body>
</html>
